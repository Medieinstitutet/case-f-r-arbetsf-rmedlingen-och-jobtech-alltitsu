import{r as bt,h as y,g as vt}from"./index-55b4449e.js";import{_ as wt}from"./text-2fb6c0c4-138bda8d.js";import{s as l,r as Dt,a as rt,f as S,p as x,b as q,l as H,m as C,c as lt,o as At,e as Tt,i as kt}from"./linear-6a2614d1-19247fc9.js";import{r as St}from"./randomIdGenerator.util-3b67728e-458080ee.js";function Ct(s){let t;for(;t=s.sourceEvent;)s=t;return s}function z(s,t){if(s=Ct(s),t===void 0&&(t=s.currentTarget),t){var i=t.ownerSVGElement||t;if(i.createSVGPoint){var e=i.createSVGPoint();return e.x=s.clientX,e.y=s.clientY,e=e.matrixTransform(t.getScreenCTM().inverse()),[e.x,e.y]}if(t.getBoundingClientRect){var a=t.getBoundingClientRect();return[s.clientX-a.left-t.clientLeft,s.clientY-a.top-t.clientTop]}}return[s.pageX,s.pageY]}const Lt={passive:!1},F={capture:!0,passive:!1};function U(s){s.stopImmediatePropagation()}function L(s){s.preventDefault(),s.stopImmediatePropagation()}function Pt(s){var t=s.document.documentElement,i=l(s).on("dragstart.drag",L,F);"onselectstart"in t?i.on("selectstart.drag",L,F):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function $t(s,t){var i=s.document.documentElement,e=l(s).on("dragstart.drag",null);t&&(e.on("click.drag",L,F),setTimeout(function(){e.on("click.drag",null)},0)),"onselectstart"in i?e.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}const j=s=>()=>s;function Q(s,{sourceEvent:t,subject:i,target:e,identifier:a,active:n,x:h,y:c,dx:o,dy:u,dispatch:p}){Object.defineProperties(this,{type:{value:s,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:i,enumerable:!0,configurable:!0},target:{value:e,enumerable:!0,configurable:!0},identifier:{value:a,enumerable:!0,configurable:!0},active:{value:n,enumerable:!0,configurable:!0},x:{value:h,enumerable:!0,configurable:!0},y:{value:c,enumerable:!0,configurable:!0},dx:{value:o,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:p}})}Q.prototype.on=function(){var s=this._.on.apply(this._,arguments);return s===this._?this:s};function Vt(s){return!s.ctrlKey&&!s.button}function zt(){return this.parentNode}function Ft(s,t){return t??{x:s.x,y:s.y}}function Mt(){return navigator.maxTouchPoints||"ontouchstart"in this}function Nt(){var s=Vt,t=zt,i=Ft,e=Mt,a={},n=Tt("start","drag","end"),h=0,c,o,u,p,m=0;function d(r){r.on("mousedown.drag",D).filter(e).on("touchstart.drag",G).on("touchmove.drag",N,Lt).on("touchend.drag touchcancel.drag",E).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function D(r,g){if(!(p||!s.call(this,r,g))){var f=V(this,t.call(this,r,g),r,g,"mouse");f&&(l(r.view).on("mousemove.drag",$,F).on("mouseup.drag",M,F),Pt(r.view),U(r),u=!1,c=r.clientX,o=r.clientY,f("start",r))}}function $(r){if(L(r),!u){var g=r.clientX-c,f=r.clientY-o;u=g*g+f*f>m}a.mouse("drag",r)}function M(r){l(r.view).on("mousemove.drag mouseup.drag",null),$t(r.view,u),L(r),a.mouse("end",r)}function G(r,g){if(s.call(this,r,g)){var f=r.changedTouches,_=t.call(this,r,g),b=f.length,A,k;for(A=0;A<b;++A)(k=V(this,_,r,g,f[A].identifier,f[A]))&&(U(r),k("start",r,f[A]))}}function N(r){var g=r.changedTouches,f=g.length,_,b;for(_=0;_<f;++_)(b=a[g[_].identifier])&&(L(r),b("drag",r,g[_]))}function E(r){var g=r.changedTouches,f=g.length,_,b;for(p&&clearTimeout(p),p=setTimeout(function(){p=null},500),_=0;_<f;++_)(b=a[g[_].identifier])&&(U(r),b("end",r,g[_]))}function V(r,g,f,_,b,A){var k=n.copy(),v=z(A||f,g),et,st,B;if((B=i.call(r,new Q("beforestart",{sourceEvent:f,target:d,identifier:b,active:h,x:v[0],y:v[1],dx:0,dy:0,dispatch:k}),_))!=null)return et=B.x-v[0]||0,st=B.y-v[1]||0,function yt(W,at,xt){var nt=v,X;switch(W){case"start":a[b]=yt,X=h++;break;case"end":delete a[b],--h;case"drag":v=z(xt||at,g),X=h;break}k.call(W,r,new Q(W,{sourceEvent:at,subject:B,target:d,identifier:b,active:X,x:v[0]+et,y:v[1]+st,dx:v[0]-nt[0],dy:v[1]-nt[1],dispatch:k}),_)}}return d.filter=function(r){return arguments.length?(s=typeof r=="function"?r:j(!!r),d):s},d.container=function(r){return arguments.length?(t=typeof r=="function"?r:j(r),d):t},d.subject=function(r){return arguments.length?(i=typeof r=="function"?r:j(r),d):i},d.touchable=function(r){return arguments.length?(e=typeof r=="function"?r:j(!!r),d):e},d.on=function(){var r=n.on.apply(n,arguments);return r===n?d:r},d.clickDistance=function(r){return arguments.length?(m=(r=+r)*r,d):Math.sqrt(m)},d}const Et=s=>+s;function J(s){return((s*=2)<=1?s*s:--s*(2-s)+1)/2}const tt=Math.PI,it=2*tt,T=1e-6,Bt=it-T;function ct(s){this._+=s[0];for(let t=1,i=s.length;t<i;++t)this._+=arguments[t]+s[t]}function Ht(s){let t=Math.floor(s);if(!(t>=0))throw new Error(`invalid digits: ${s}`);if(t>15)return ct;const i=10**t;return function(e){this._+=e[0];for(let a=1,n=e.length;a<n;++a)this._+=Math.round(arguments[a]*i)/i+e[a]}}class jt{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?ct:Ht(t)}moveTo(t,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+i}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,i){this._append`L${this._x1=+t},${this._y1=+i}`}quadraticCurveTo(t,i,e,a){this._append`Q${+t},${+i},${this._x1=+e},${this._y1=+a}`}bezierCurveTo(t,i,e,a,n,h){this._append`C${+t},${+i},${+e},${+a},${this._x1=+n},${this._y1=+h}`}arcTo(t,i,e,a,n){if(t=+t,i=+i,e=+e,a=+a,n=+n,n<0)throw new Error(`negative radius: ${n}`);let h=this._x1,c=this._y1,o=e-t,u=a-i,p=h-t,m=c-i,d=p*p+m*m;if(this._x1===null)this._append`M${this._x1=t},${this._y1=i}`;else if(d>T)if(!(Math.abs(m*o-u*p)>T)||!n)this._append`L${this._x1=t},${this._y1=i}`;else{let D=e-h,$=a-c,M=o*o+u*u,G=D*D+$*$,N=Math.sqrt(M),E=Math.sqrt(d),V=n*Math.tan((tt-Math.acos((M+d-G)/(2*N*E)))/2),r=V/E,g=V/N;Math.abs(r-1)>T&&this._append`L${t+r*p},${i+r*m}`,this._append`A${n},${n},0,0,${+(m*D>p*$)},${this._x1=t+g*o},${this._y1=i+g*u}`}}arc(t,i,e,a,n,h){if(t=+t,i=+i,e=+e,h=!!h,e<0)throw new Error(`negative radius: ${e}`);let c=e*Math.cos(a),o=e*Math.sin(a),u=t+c,p=i+o,m=1^h,d=h?a-n:n-a;this._x1===null?this._append`M${u},${p}`:(Math.abs(this._x1-u)>T||Math.abs(this._y1-p)>T)&&this._append`L${u},${p}`,e&&(d<0&&(d=d%it+it),d>Bt?this._append`A${e},${e},0,1,${m},${t-c},${i-o}A${e},${e},0,1,${m},${this._x1=u},${this._y1=p}`:d>T&&this._append`A${e},${e},0,${+(d>=tt)},${m},${this._x1=t+e*Math.cos(n)},${this._y1=i+e*Math.sin(n)}`)}rect(t,i,e,a){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+i}h${e=+e}v${+a}h${-e}Z`}toString(){return this._}}function w(s){return function(){return s}}const dt=Math.cos,O=Math.sin,P=Math.sqrt,R=Math.PI,Y=2*R;function ut(s){let t=3;return s.digits=function(i){if(!arguments.length)return t;if(i==null)t=null;else{const e=Math.floor(i);if(!(e>=0))throw new RangeError(`invalid digits: ${i}`);t=e}return s},()=>new jt(t)}function It(s){return typeof s=="object"&&"length"in s?s:Array.from(s)}function gt(s){this._context=s}gt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(s,t){switch(s=+s,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(s,t):this._context.moveTo(s,t);break;case 1:this._point=2;default:this._context.lineTo(s,t);break}}};function Ot(s){return new gt(s)}function Rt(s){return s[0]}function Yt(s){return s[1]}function Z(s,t){var i=w(!0),e=null,a=Ot,n=null,h=ut(c);s=typeof s=="function"?s:s===void 0?Rt:w(s),t=typeof t=="function"?t:t===void 0?Yt:w(t);function c(o){var u,p=(o=It(o)).length,m,d=!1,D;for(e==null&&(n=a(D=h())),u=0;u<=p;++u)!(u<p&&i(m=o[u],u,o))===d&&((d=!d)?n.lineStart():n.lineEnd()),d&&n.point(+s(m,u,o),+t(m,u,o));if(D)return n=null,D+""||null}return c.x=function(o){return arguments.length?(s=typeof o=="function"?o:w(+o),c):s},c.y=function(o){return arguments.length?(t=typeof o=="function"?o:w(+o),c):t},c.defined=function(o){return arguments.length?(i=typeof o=="function"?o:w(!!o),c):i},c.curve=function(o){return arguments.length?(a=o,e!=null&&(n=a(e)),c):a},c.context=function(o){return arguments.length?(o==null?e=n=null:n=a(e=o),c):e},c}const pt={draw(s,t){const i=P(t/R);s.moveTo(i,0),s.arc(0,0,i,0,Y)}},mt=P(1/3),Gt=mt*2,Wt={draw(s,t){const i=P(t/Gt),e=i*mt;s.moveTo(0,-i),s.lineTo(e,0),s.lineTo(0,i),s.lineTo(-e,0),s.closePath()}},Xt=.8908130915292852,ft=O(R/10)/O(7*R/10),qt=O(Y/10)*ft,Ut=-dt(Y/10)*ft,Jt={draw(s,t){const i=P(t*Xt),e=qt*i,a=Ut*i;s.moveTo(0,-i),s.lineTo(e,a);for(let n=1;n<5;++n){const h=Y*n/5,c=dt(h),o=O(h);s.lineTo(o*i,-c*i),s.lineTo(c*e-o*a,o*e+c*a)}s.closePath()}},K=P(3),Zt={draw(s,t){const i=-P(t/(K*3));s.moveTo(0,i*2),s.lineTo(-K*i,-i),s.lineTo(K*i,-i),s.closePath()}};function I(s,t){let i=null,e=ut(a);s=typeof s=="function"?s:w(s||pt),t=typeof t=="function"?t:w(t===void 0?64:+t);function a(){let n;if(i||(i=n=e()),s.apply(this,arguments).draw(i,+t.apply(this,arguments)),n)return i=null,n+""||null}return a.type=function(n){return arguments.length?(s=typeof n=="function"?n:w(n),a):s},a.size=function(n){return arguments.length?(t=typeof n=="function"?n:w(+n),a):t},a.context=function(n){return arguments.length?(i=n??null,a):i},a}function ot(s,t,i){s._context.bezierCurveTo((2*s._x0+s._x1)/3,(2*s._y0+s._y1)/3,(s._x0+2*s._x1)/3,(s._y0+2*s._y1)/3,(s._x0+4*s._x1+t)/6,(s._y0+4*s._y1+i)/6)}function _t(s){this._context=s}_t.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:ot(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(s,t){switch(s=+s,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(s,t):this._context.moveTo(s,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:ot(this,s,t);break}this._x0=this._x1,this._x1=s,this._y0=this._y1,this._y1=t}};function ht(s){return new _t(s)}const Kt=".sc-digi-chart-line-h{display:block;height:100%;width:100%;position:relative}.sc-digi-chart-line-h .digi-chart-line.sc-digi-chart-line{color:var(--MY-PROP);height:100%;width:100%;min-height:-moz-fit-content;min-height:fit-content}.buttonWrapper.sc-digi-chart-line{--digi--button--padding--medium:0 0 0.75rem 0}.chart.sc-digi-chart-line{box-sizing:content-box;width:auto}.chartTitle.sc-digi-chart-line{--digi--typography--h2--margin:0.5rem;--digi--typography--h3--margin:0.5rem;--digi--typography--h4--margin:0.5rem;--digi--typography--h5--margin:0.5rem;--digi--typography--h6--margin:0.5rem;display:flex;justify-content:flex-start;flex-direction:column;align-items:left;text-align:left;padding-bottom:1rem;flex-grow:2}.close.sc-digi-chart-line{--digi--icon--color:rgb(245, 245, 245);cursor:pointer;margin-top:-5px}.legend.sc-digi-chart-line{display:flex;flex-direction:row;flex-wrap:no-wrap;gap:0.5rem;margin:0.5rem 0;margin-top:1.25rem;height:2.675rem;overflow-x:auto;overflow-y:hidden;cursor:default;max-width:100%}.chip.sc-digi-chart-line{box-sizing:border-box}.legend.sc-digi-chart-line::-webkit-scrollbar,.table.sc-digi-chart-line::-webkit-scrollbar{height:10px;width:10px}.legend.sc-digi-chart-line::-webkit-scrollbar-track,.table.sc-digi-chart-line::-webkit-scrollbar-track{background:whitesmoke;border-radius:4px}.legend.sc-digi-chart-line::-webkit-scrollbar-thumb,.table.sc-digi-chart-line::-webkit-scrollbar-thumb{background-color:lightgray;border-radius:4px;border:0}.chartTooltip.sc-digi-chart-line{box-sizing:border-box;position:absolute;background-color:rgba(10, 10, 10, 0.9);color:white;padding:5px 10px;padding-right:5px;border-radius:4px;display:flex;flex-direction:row;align-items:flex-start;box-shadow:rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 2px 6px 2px;font-size:14px;display:none}.scChartStatus.sc-digi-chart-line{border:0;clip:rect(1px, 1px, 1px, 1px);-webkit-clip-path:inset(50%);clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap}.table.sc-digi-chart-line{display:none;overflow-y:scroll;height:-moz-fit-content;height:fit-content;border-radius:4px;padding:0.25rem;background:linear-gradient(white 30%, rgba(255, 255, 255, 0)) center top, linear-gradient(rgba(255, 255, 255, 0), white 70%) center bottom, radial-gradient(farthest-side at 50% 0, rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0)) center top, radial-gradient(farthest-side at 50% 100%, rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0)) center bottom;background-repeat:no-repeat;background-size:100% 40px, 100% 40px, 100% 14px, 100% 14px;background-attachment:local, local, scroll, scroll}.tableIcon.sc-digi-chart-line{--digi--icon--color:var(--digi--global--color--neutral--grayscale--darker);width:26px;height:26px;pointer-events:none}.tableIcon.sc-digi-chart-line:hover{--digi--icon--color:var(--digi--global--color--neutral--grayscale--darkest-3)}.tooltipBody.sc-digi-chart-line{display:flex;flex-direction:column;margin-right:5px}.topWrapper.sc-digi-chart-line{display:flex;flex-direction:row;align-items:flex-end;justify-content:space-between;flex-wrap:wrap}",Qt=class{constructor(s){bt(this,s),this._lineTypes=[null,"1.0, 7.0","9.0, 7.0"],this._toggled=!1,this._tickSize=0,this._selectedLines=[],this._dragStart=0,this._dragDir=0,this._loading=!1,this.margin={bottom:0,top:3,left:5,right:15},this.fontSize="0.875rem",this.xPadding=5,this.yPadding=8,this.xTickSize=5,this.lineTypes=3,this.formatStyle=",d",this.axisNumberFormat={decimal:",",thousands:" ",grouping:[3],currency:["","kr"]},this.lineChartObserver=new ResizeObserver(t=>{t.forEach(()=>{this.resizeSvg(),this.resizeLines(),this.repositionTooltip(),l(this._legendDiv).style("width",this.dims.width+"px")})}),this.tableObserver=new ResizeObserver(t=>{t.forEach(()=>{l(this._legendDiv).style("width",this.dims.width+"px"),this.resizeTable()})}),this.dragStart=t=>{const i=l(this._legendDiv).node();this._dragStart=t.x-i.offsetLeft,this._scrollLeft=i.scrollLeft},this.drag=t=>{const i=l(this._legendDiv);this._dragDir=t.x;const a=(this._dragDir-i.node().offsetLeft-this._dragStart)*1;i.property("scrollLeft",this._scrollLeft-a)},this.setYTicks=(t=!1)=>{var i=this._chartData.meta&&this._chartData.meta.numberOfReferenceLines?this._chartData.meta.numberOfReferenceLines:5,e=this._yAxis.domain()[0],a=this._yAxis.domain()[1],n=(a-e)/(i-1),h=Dt(e,a+n,n);t?this._yAxisHandle.style("font-size",this.fontSize).call(rt(this._yAxis).ticks(i).tickPadding(this.yPadding).tickValues(h).tickSize(-(this.dims.width-this.margin.left)).tickFormat(c=>S(this.axisNumberFormat).format(this.formatStyle)(c))):this._yAxisHandle.style("font-size",this.fontSize).transition().duration(400).call(rt(this._yAxis).ticks(i).tickPadding(this.yPadding).tickValues(h).tickSize(-(this.dims.width-this.margin.left)).tickFormat(c=>S(this.axisNumberFormat).format(this.formatStyle)(c))).on("end",()=>this.leftSetAxis()),this._yAxisHandle.selectAll("line").attr("stroke",getComputedStyle(document.documentElement).getPropertyValue("--digi--global--color--neutral--grayscale--darker").trim().toLocaleLowerCase()),this._yAxisHandle.select(".domain").attr("display","none"),t&&this.leftSetAxis(t)},this.addListenersToChart=()=>{this._Tipbox.style("cursor","pointer").on("mousemove",this.drawTooltipLine).on("touchmove","ontouchstart"in window||window.navigator.maxTouchPoints?this.drawTooltip:null).on("mouseup",this.drawTooltip).on("mouseleave",()=>{this._secondaryLine.attr("display","none"),this._toggled||(this._TooltipLine.attr("display","none"),this._Circles.selectAll("circle").attr("display","none"))})},this.initLegend=()=>{const t=l(this._legendDiv);l(this._legendDiv).style("width",this.dims.width+"px"),t.selectAll(".chip").remove(),t.call(Nt().on("start",this.dragStart).on("drag",this.drag)),t.selectAll("legendChips").data(this._chartData.data.series).join("button").attr("class","chip").attr("type","button").attr("aria-pressed",!1).style("padding","0.15rem 0.75rem").style("border","2px solid white").style("border-radius","6px").style("display","flex").style("flex-direction","row").style("gap","0.5rem").style("align-items","center").style("flex-wrap","nowrap").style("min-width","fit-content").style("height","calc(2rem - 2px)").style("font-size",this.fontSize).style("white-space","nowrap").style("box-sizing","border-box").style("background-color","white").style("cursor","pointer").html(i=>'<span style="pointer-events:none;">'+i.title+"</span>").on("click",this.togglePath).on("mouseover",this.highlightPath).on("mouseleave",this.colorLines).datum(i=>i).insert("svg","span").attr("class","legendSvg").attr("pointer-events","none").attr("width",32).attr("height",28).append("line").attr("stroke",i=>this.colorFunction(i)).attr("stroke-linecap","round").attr("stroke-width",6).attr("stroke-dasharray",(i,e)=>this.dashFunction(i,e)).attr("x1",3).attr("x2",29).attr("y1","50%").attr("y2","50%"),!(this._chartData.data.series.length<=this.lineTypes)&&t.selectAll(".legendSvg").filter((...[,i])=>i>2).append("path").attr("d",(...[,i])=>this.symbolType(i,110)).attr("fill",i=>this.colorFunction(i)).attr("transform","translate(16,14)")},this.highlightPath=(t,i)=>{if(t.target.className!="chip")return;l(t.target).style("border",a=>"2px solid "+this.colorFunction(a)),this._lineChartContainer.selectAll(".linePath").transition("highlight").duration(150).attr("stroke",(a,n,h)=>a.title===i.title?(l(h[n]).raise(),this.colorFunction(a)):"#E3E3E3"),this._lineChartContainer.selectAll(".symbolGroup").attr("fill",(a,n,h)=>{a.title===i.title&&l(h[n]).raise()}),this._lineChartContainer.selectAll(".symbolGroup").selectAll(".symbol").transition("highlight").duration(150).attr("fill",a=>{if(a)return a.title===i.title?this.colorFunction(a):"#E3E3E3"})},this.togglePath=t=>{if(t.target.className!="chip")return;const i=l(t.target),e=i.style("color")==="white";i.style("border",a=>"2px solid "+this.colorFunction(a)).style("background-color",a=>e?"white":this.colorFunction(a)).style("color",()=>e?"black":"white").attr("aria-pressed",i.attr("aria-pressed")=="false").select("line").attr("stroke",a=>e?this.colorFunction(a):"white"),i.select("path").attr("fill",a=>e?this.colorFunction(a):"white"),e?this._selectedLines=this._selectedLines.filter(a=>a.title!==i.datum().title):this._selectedLines.push(this._coreSeries.filter(a=>a.title===i.datum().title)[0]),this._selectedLines.length<1?this._chartData.data.series=JSON.parse(JSON.stringify(this._coreSeries)):this._chartData.data.series.map(a=>{const n=this._selectedLines.findIndex(h=>a.title===h.title);n!=-1?a.yValues=this._selectedLines[n].yValues:a.yValues=[]}),this.updateSvg()},this.colorLines=t=>{l(t.target).style("border","2px solid white"),this._lineChartContainer.selectAll(".linePath").transition("highlight").duration(150).attr("stroke",e=>this.colorFunction(e)),this._lineChartContainer.selectAll(".symbolGroup").selectAll(".symbol").transition("highlight").duration(150).attr("fill",e=>e?this.colorFunction(e):null)},this.dashFunction=(...[,t])=>this._lineTypes[t%this._lineTypes.length],this.initLines=()=>{this.defineLineAndScale(),this._lineChartContainer.selectAll("linePath").data(this.reshapeData(this._chartData.data.series)).join("path").attr("class","linePath").attr("stroke",t=>this.colorFunction(t)).attr("stroke-linecap","round").attr("stroke-width",t=>t.length>1?4:6).attr("stroke-dasharray",(t,i)=>t.length>1?this.dashFunction(t,i):null).attr("fill","none").attr("d",t=>this._LineFunc(t.line)),this.addSymbols()},this.defineLineAndScale=()=>{this._LineFunc=Z().defined(t=>t[1]!=null&&t[1]!=null&&!isNaN(t[1])).x(t=>this._lineScale(t[0])).y(t=>this._yAxis(t[1]))},this.reshapeData=t=>t.map(i=>(i.line=this._chartData.data.xValues.map((e,a)=>[e,i.yValues[a]]),i.length=i.yValues.filter(e=>e!=null&&e!=null).length,i)),this.addSymbols=(t=!1)=>{this._lineChartContainer.selectAll(".symbolGroup").data(this.reshapeData(this._chartData.data.series.filter((...[,i])=>i>2))).join(i=>{t?i.append("g").attr("class","symbolGroup").selectAll("symbol").data((e,a)=>e.line.map(n=>n[1]!=null?{val:n[1],x:n[0],title:e.title,colorToken:e.colorToken,index:a}:null)).join("path").attr("class","symbol").attr("d",e=>e?this.symbolType(e.index):null).attr("fill",e=>e?this.colorFunction(e):null).attr("transform",e=>e?`translate(${this._lineScale(e.x)},${this._yAxis(e.val)})`:null):i.append("g").attr("class","symbolGroup").selectAll("symbols").data((e,a)=>e.line.map(n=>n[1]!=null?{val:n[1],x:n[0],title:e.title,colorToken:e.colorToken,index:a}:null)).join("path").attr("class","symbol").attr("d",e=>e?this.symbolType(e.index):null).attr("fill",e=>e?this.colorFunction(e):null).attr("transform",e=>e?`translate(${this._lineScale(e.x)},${this._yAxis(e.val)})`:null)},i=>{t?i.selectAll("path").data((e,a)=>e.line.map(h=>h[1]!=null?{val:h[1],x:h[0],title:e.title,colorToken:e.colorToken,index:a}:null).filter(h=>h)).join(e=>{e.append("path").attr("class","symbol").attr("d",a=>a?this.symbolType(a.index):null).attr("fill",a=>a?this.colorFunction(a):null).attr("transform",a=>a?`translate(${this._lineScale(a.x)},${this._yAxis(a.val)})`:null).attr("opacity",0).transition().duration(400).ease(x).attr("opacity",1)},e=>{e.transition().duration(400).ease(x).attr("d",a=>a?this.symbolType(a.index):null).attr("fill",a=>a?this.colorFunction(a):null).attr("transform",a=>a?`translate(${this._lineScale(a.x)},${this._yAxis(a.val)})`:null)},e=>e.remove()):i.selectAll(".symbol").data((e,a)=>e.line.map(n=>n[1]!=null?{val:n[1],x:n[0],title:e.title,colorToken:e.colorToken,index:a}:null)).join("path").attr("class","symbol").attr("d",e=>e?this.symbolType(e.index):null).attr("fill",e=>e?this.colorFunction(e):null).attr("transform",e=>e?`translate(${this._lineScale(e.x)},${this._yAxis(e.val)})`:null)},i=>i.remove())},this.symbolType=(t,i)=>t<this.lineTypes?I().type(pt).size(i||90)():t>=this.lineTypes&&t<this.lineTypes*2?I().type(Wt).size(i||90)():I().type(Jt).size(i||90)(),this.setDims=(t=!1)=>{const i=l(this._titleDiv).node().getBoundingClientRect(),e=l(this._legendDiv).node().getBoundingClientRect(),a=parseFloat(getComputedStyle(document.documentElement).fontSize);t||(this.dims=l(this._chartDiv).node().getBoundingClientRect()),this.dims.height=this._maxHeight-e.height-i.height-1.75*a},this.resizeSvg=()=>{if(this._loading)return this.loadingResize();this.setDims(),this._svg.attr("width",this.dims.width).attr("height",this.dims.height),this._yAxis.range([this.dims.height-this.margin.bottom,this.margin.top]),this.setYTicks(!0),this._xAxis.range([0,this.dims.width-this.margin.left-this.margin.right]);const t=Math.min(Math.max(Math.floor((this.dims.width-this.margin.left-this.margin.right)/this._tickSize)-2,1),this._chartData.data.xValues.length);this._xAxisHandle.attr("transform","translate(0,"+(this.dims.height-this.margin.bottom)+")").call(q(this._xAxis).ticks(t).tickPadding(this.xPadding).tickFormat(i=>this._chartData.data.xValueNames?this._chartData.data.xValueNames[this._chartData.data.xValues.indexOf(i)]:i)),this._Tipbox.attr("width",this.dims.width-this.margin.left/2).attr("height",this.dims.height-this.margin.top-this.margin.bottom).attr("transform",`translate(${this.margin.left/2},${this.margin.top})`)},this.loadingResize=()=>{this.setDims(),this._svg.attr("width",this.dims.width),this.setYTicks(),this._xAxis.range([0,this.dims.width-this.margin.left-this.margin.right]);const t=Math.min(Math.floor((this.dims.width-this.margin.left-this.margin.right)/this._tickSize)-2,this._xAxis.domain()[1]);this._xAxisHandle.call(q(this._xAxis).ticks(t).tickPadding(this.xPadding).tickFormat(e=>this._chartData.data&&this._chartData.data.xValueNames?this._chartData.data.xValueNames[this._chartData.data.xValues.indexOf(e)]:e)),this._lineScale.range([0,this.dims.width-this.margin.left-this.margin.right]);const i=Z().defined(e=>e[1]!=null).x(e=>this._lineScale(e[0])).y(e=>this._yAxis(e[1])).curve(ht);this._lineChartContainer.selectAll(".linePath").attr("d",e=>i(e))},this.resizeLines=()=>{this._loading||(this._lineScale.range([0,this.dims.width-this.margin.left-this.margin.right]),this.defineLineAndScale(),this._lineChartContainer.selectAll(".linePath").attr("stroke",t=>this.colorFunction(t)).attr("d",t=>this._LineFunc(t.line)),this._lineChartContainer.selectAll(".symbolGroup").selectAll(".symbol").attr("transform",(t,i)=>t?`translate(${this._lineScale(this._chartData.data.xValues[i])},${this._yAxis(t.val)})`:null))},this.colorFunction=t=>t.colorToken?getComputedStyle(document.documentElement).getPropertyValue(t.colorToken).trim().toLocaleLowerCase():this._Color(t.title),this.drawTooltipLine=t=>{if(this._toggled)return this.drawDottedLine(t);this.drawMainLineAndCircles(t)},this.closeTooltip=()=>{this._toggled=!1,this._tooltip.style("display","none"),this._secondaryLine.attr("display","none"),this._TooltipLine.attr("display","none"),this._Circles.selectAll("circle").attr("display","none"),this._Circles.selectAll("circle").attr("fill","white").attr("stroke",t=>this.colorFunction(t)),this._svg.select(".tooltipPointer").remove()},this.drawDottedLine=t=>{if(this._hoverPoint=this.closest(Math.round(this._lineScale.invert(z(t,this._Tipbox.node())[0]-this.margin.left/2))),this._hoverPoint===this._tooltipPoint)return this._secondaryLine.attr("display","none");this._secondaryLine.attr("display",null).attr("stroke","gray").attr("stroke-dasharray",4).attr("x1",this._xAxis(this._hoverPoint.toString())+this.margin.left).attr("x2",this._xAxis(this._hoverPoint.toString())+this.margin.left).attr("y1",this._yAxis(this._maxVal)).attr("y2",this.dims.height-this.margin.bottom).style("pointer-events","none")},this.drawMainLineAndCircles=t=>{this._hoverPoint=this.touchPosition(t);const i=this._hoverPoint.toString();this._TooltipLine.attr("display",null).attr("stroke","gray").attr("x1",this._xAxis(i)+this.margin.left).attr("x2",this._xAxis(i)+this.margin.left).attr("y1",this._yAxis(this._maxVal)).attr("y2",this.dims.height-this.margin.bottom).style("pointer-events","none"),this._Circles.selectAll("circle").attr("display",null).attr("pointer-events","none"),this.positionCircles(i)},this.touchPosition=t=>t.type==="touchmove"?(t.preventDefault(),this.closest(Math.round(this._lineScale.invert(z(t.touches[0],this._Tipbox.node())[0]-this.margin.left/2)))):this.closest(Math.round(this._lineScale.invert(z(t,this._Tipbox.node())[0]-this.margin.left/2))),this.drawTooltip=t=>{this.drawMainLineAndCircles(t),this._toggled=!0,this._tooltipPoint=this.touchPosition(t),this._tooltipDataIndex=this._chartData.data.xValues.indexOf(this._tooltipPoint),this._tooltip.style("display","flex");let i=this._tooltip.select(".tooltipBody");i.select(this._tooltipHeading).style("margin","0 0.75rem 0 0 ").html(()=>this._chartData.data.xValueNames?this._chartData.data.xValueNames[this._chartData.data.xValues.indexOf(this._tooltipPoint)]:this._tooltipPoint),i.selectAll("div").data(this._chartData.data.series).join("div").style("display","flex").style("flex-direction","row").style("flex-wrap","nowrap").style("white-space","nowrap").style("justify-content","space-between").html(a=>a.yValues[this._tooltipDataIndex]!=null?"<span>"+a.title+'</span><span style="margin-left:0.75rem;">'+S(this.axisNumberFormat).format(this.formatStyle)(a.yValues[this._tooltipDataIndex])+"</span>":null),this.positionTooltipWithinBounds(this._xAxis(this._tooltipPoint.toString())+this.margin.left),this._Circles.selectAll("circle").attr("fill",a=>this.colorFunction(a)).attr("stroke","white"),this._svg.select(".tooltipPointer").remove();const e=I().type(Zt).size(60);this._svg.append("path").attr("d",e).attr("class","tooltipPointer").attr("fill","rgba(10, 10, 10, 0.90)").style("filter","drop-shadow(gray 0px -1px 1px)").attr("transform",`translate(${this._xAxis(this._tooltipPoint.toString())+this.margin.left},${this._yAxis(this._maxVal)-7}) rotate(180) scale(1.5,1.0)`)},this.initYAxis=t=>{this._yAxis=H().domain([0,t?10:this._maxVal]).nice(3).range([this.dims.height-this.margin.bottom,this.margin.top]),this.margin.left=this.getTextSize(S(this.axisNumberFormat).format(this.formatStyle)(this._yAxis.domain()[1]))+this.yPadding+3,this._lineChartContainer=this._svg.append("g").attr("transform",`translate(${this.margin.left},0)`),this._yAxisHandle=this._lineChartContainer.append("g").attr("class","yAxis"),this.setYTicks(!0)},this.initXAxis=t=>{this._lineChartContainer.select(".xAxis").remove(),t||(this._chartData.data.xValueNames?this.margin.right=this.getTextSize(this._chartData.data.xValueNames[this._chartData.data.xValueNames.length-1])/2+1:this.margin.right=this.getTextSize(C(this._chartData.data.xValues).toString())/2+1),this._xAxis=H().domain([t?1:lt(this._chartData.data.xValues),t?10:C(this._chartData.data.xValues)]).range([0,this.dims.width-this.margin.left-this.margin.right]),this._lineScale=H().domain([t?1:lt(this._chartData.data.xValues),t?10:C(this._chartData.data.xValues)]).range([0,this.dims.width-this.margin.left-this.margin.right]);const i=Math.min(Math.max(Math.floor((this.dims.width-this.margin.left-this.margin.right)/this._tickSize)-2,2),t?10:this._chartData.data.xValues.length);this._xAxisHandle=this._lineChartContainer.append("g").attr("transform","translate(0,"+(this.dims.height-this.margin.bottom)+")").attr("class","xAxis").style("font-size",this.fontSize).call(q(this._xAxis).ticks(i).tickSize(this.xTickSize).tickPadding(this.xPadding).tickFormat(e=>!t&&this._chartData.data.xValueNames?this._chartData.data.xValueNames[this._chartData.data.xValues.indexOf(e)]:e)),this._xAxisHandle.select(".domain").attr("display","none"),this._xAxisHandle.selectAll("line").attr("stroke-linecap","round").attr("stroke",getComputedStyle(document.documentElement).getPropertyValue("--digi--global--color--neutral--grayscale--darkest-3").trim().toLocaleLowerCase())},this.positionCircles=(t,i)=>{i?this._Circles.selectAll("circle").transition("positioncircles").duration(i).attr("cx",()=>this._xAxis(t)+this.margin.left).attr("cy",(e,a,n)=>{let h=e.yValues[this._chartData.data.xValues.indexOf(parseInt(t))];return this._yAxis(h)?this._yAxis(h):(l(n[a]).attr("display","none"),null)}):this._Circles.selectAll("circle").attr("cx",()=>this._xAxis(t)+this.margin.left).attr("cy",(e,a,n)=>{let h=e.yValues[this._chartData.data.xValues.indexOf(parseInt(t))];return this._yAxis(h)?this._yAxis(h):(l(n[a]).attr("display","none"),null)})},this.repositionTooltip=()=>{if(!this._toggled)return;const t=this._chartData.data.xValues[this._tooltipDataIndex].toString();this._TooltipLine.attr("stroke","gray").attr("x1",this._xAxis(t)+this.margin.left).attr("x2",this._xAxis(t)+this.margin.left).attr("y1",this._yAxis(this._maxVal)).attr("y2",this.dims.height-this.margin.bottom),this.positionTooltipWithinBounds(this._xAxis(t)+this.margin.left),this._svg.select(".tooltipPointer").attr("transform",`translate(${this._xAxis(this._tooltipPoint.toString())+this.margin.left},${this._yAxis(this._maxVal)-7}) rotate(180) scale(1.5,1.0)`),this.positionCircles(t)},this.positionTooltipWithinBounds=(t,i)=>{this._tooltip.style("transform",()=>`translateY(${this._yAxis(this._maxVal)-this._tooltip.node().getBoundingClientRect().height-9}px)`);const e=this._chartDiv.getBoundingClientRect(),a=t+e.left,n=this._tooltip.node().getBoundingClientRect().width/2;e.left<a-n&&e.right>a+n?this._tooltip.style("left",t-n+"px"):e.right<a+n?this._tooltip.style("left",t-this._tooltip.node().getBoundingClientRect().width+Math.max(this.margin.right,10)+"px"):e.left>a-n?i?this._tooltip.transition("moveTooltip").duration(i).ease(x).style("left",t-this.margin.left+"px"):this._tooltip.style("left",t-this.margin.left+"px"):this._tooltip.style("left",t-document.getElementById(this.afId).getBoundingClientRect().width/2+"px")},this.mapColorToLine=()=>{this._Color=At().domain(this._chartData.data.series.map(function(t){return t.title})).range(["#00005a","#D43372","#058470","#0058A3","#556D22","#1616B2","#AA295B","#035548"])},this.computeMaxVal=()=>{this._maxVal=parseFloat(C(this._chartData.data.series,t=>C(t.yValues)))},this.checkPercentage=()=>{this._chartData.meta&&this._chartData.meta.percentage?this.formatStyle=".1%":this.formatStyle=",d"},this.closest=t=>this._chartData.data.xValues.reduce(function(i,e){return Math.abs(e-t)<Math.abs(i-t)?e:i}),this.activateTable=t=>{this.closeTooltip(),this.lineChartObserver.disconnect(),this.tableObserver.observe(this._chartDiv),this._status.innerHTML="<p>Visas som tabell</p>",l(this._host).select(".tableButton").style("display","none"),l(this._host).select(".chartButton").style("display",null),t.target.nextSibling.lastChild.focus();const i=150;this._svg.attr("opacity",1).transition("fadeout").duration(i).attr("opacity",0).on("end",()=>{this._svg.remove(),this._legendDiv.style.display="none",this._tableDiv.style.display="block",this.setTableContent(),this.setTableDimensions(),l(this._tableDiv).style("opacity",0).transition("fadein").duration(i).style("opacity",1)}),l(this._legendDiv).style("opacity",1).transition("fadeout").duration(i).style("opacity",0)},this.resizeTable=()=>{this.setDims(),this.setTableDimensions()},this.reInitChart=t=>{this.tableObserver.disconnect(),this._status.innerHTML="<p>Visas som diagram</p>",l(this._host).select(".tableButton").style("display",null),l(this._host).select(".chartButton").style("display","none"),t.target.previousSibling.lastChild.focus();const i=l(this._tableDiv);i.style("opacity",1).transition().duration(150).style("opacity",0).on("end",()=>{i.style("display","none"),this.initSvg(),this.initLines(),this._svg.attr("opacity",0).transition().duration(150).attr("opacity",1),l(this._legendDiv).style("display",null).style("opacity",0).transition().duration(150).style("opacity",1)})},this.afHeadingLevel=void 0,this.afId=St("tooltip"),this.afChartData=void 0}afChartDataUpdate(){let s=this.afChartData;if(typeof s=="object"){this._chartData=Object.assign({},s);return}this._chartData=JSON.parse(s),this._chartData.data&&(this._coreSeries=JSON.parse(JSON.stringify(this._chartData.data.series)))}initSvg(){this.margin.bottom=Number(window.getComputedStyle(document.body).getPropertyValue("font-size").match(/\d+/)[0])*Number(this.fontSize.replace(/[^\d.]|\.(?=.*\.)/g,""))+this.xPadding+this.xTickSize,this.margin.top=Number(window.getComputedStyle(document.body).getPropertyValue("font-size").match(/\d+/)[0])*Number(this.fontSize.replace(/[^\d.]|\.(?=.*\.)/g,""))/2+this.margin.top,this.lineChartObserver.observe(this._chartDiv),l(this._chartDiv).select("svg").remove(),this._tooltip=l("#"+this.afId),this._tooltip.select(".close").on("click",this.closeTooltip),this._tooltipHeading="h"+(parseInt(this.afHeadingLevel.replace(/\D/g,""))+1),this._tooltip.selectAll(".tooltipBody").append(this._tooltipHeading).style("margin","0 0.75rem").style("font-weight","500"),this._maxHeight=l(this._host).node().parentNode.getBoundingClientRect().height,this.setDims(),this.setTickSize(),this.checkPercentage(),l(this._chartDiv).attr("height",this.dims.height+"px"),this._svg=l(this._chartDiv).append("svg").attr("aria-hidden",!0).attr("role","img").attr("aria-label",this._chartData&&this._chartData.title?"Linjediagram om "+this._chartData.title.toLowerCase():"Linjediagram"),this._svg.attr("width",this.dims.width).attr("height",this.dims.height),this.mapColorToLine(),this._TooltipLine=this._svg.append("line").attr("id","toolTipLine"+this.afId),this._secondaryLine=this._svg.append("line").attr("id","secondaryLine"+this.afId),this.computeMaxVal(),this.initYAxis(),this.initXAxis(),this._Tipbox=this._svg.append("rect").attr("class","svgRect").attr("width",this.dims.width-this.margin.left/2).attr("height",this.dims.height-this.margin.top-this.margin.bottom).attr("opacity",0).attr("transform",`translate(${this.margin.left/2},0)`),this.addListenersToChart(),this._Circles=this._svg.append("g").attr("class","circleGroup").on("mousemove",this.drawTooltipLine),this._Circles.selectAll("circle").data(this._chartData.data.series).join("circle").attr("stroke",s=>this.colorFunction(s)).attr("fill","white").attr("stroke-width","1px").attr("r",7).attr("display","none"),l(window).on("resize."+this.afId,this.repositionTooltip)}initEmpty(){this.margin.bottom=Number(window.getComputedStyle(document.body).getPropertyValue("font-size").match(/\d+/)[0])*Number(this.fontSize.replace(/[^\d.]|\.(?=.*\.)/g,""))+this.xPadding+this.xTickSize,this.margin.top=Number(window.getComputedStyle(document.body).getPropertyValue("font-size").match(/\d+/)[0])*Number(this.fontSize.replace(/[^\d.]|\.(?=.*\.)/g,""))/2+this.margin.top,l(this._chartDiv).select("svg").remove(),this._tooltip=l("#"+this.afId),l("digi-icon-x").on("click",this.closeTooltip),this._tooltipHeading="h"+(parseInt(this.afHeadingLevel.replace(/\D/g,""))+1),this._tooltip.selectAll(".tooltipBody").append(this._tooltipHeading).style("margin","0 0.75rem").style("font-weight","500"),this._maxHeight=l(this._host).node().parentNode.getBoundingClientRect().height,this.setDims(),l(this._chartDiv).attr("height",this.dims.height+"px"),this._svg=l(this._chartDiv).append("svg").attr("aria-hidden",!0),this._svg.attr("width",this.dims.width).attr("height",this.dims.height),this._TooltipLine=this._svg.append("line").attr("id","toolTipLine"+this.afId),this._secondaryLine=this._svg.append("line").attr("id","secondaryLine"+this.afId),this.initYAxis(!0),this.initXAxis(!0),this._Tipbox=this._svg.append("rect").attr("class","svgRect").attr("width",this.dims.width-this.margin.left/2).attr("height",this.dims.height-this.margin.top-this.margin.bottom).attr("opacity",0).attr("transform",`translate(${this.margin.left/2},0)`),this._Circles=this._svg.append("g").attr("class","circleGroup").on("mousemove",this.drawTooltipLine),this.defineLineAndScale(),this.lineChartObserver.observe(this._chartDiv),this.loadingState(!0)}loadingState(s){this._loading=!0,l(".tableButton").style("display","none");const t=400,i=Z().defined(h=>h[1]!=null).x(h=>this._lineScale(h[0])).y(h=>this._yAxis(h[1])).curve(ht);this.closeTooltip(),this._Tipbox.style("cursor","wait").on("mousemove",null).on("touchmove",null).on("mouseup",null).on("mouseleave",null),l(this._titleDiv).select(this.afHeadingLevel).html(`${wt.loading}...`);const e=l(this._titleDiv).style("height");l(this._titleDiv).style("height",this._prevHeight).transition("adjust").duration(400).style("height",e).on("end",()=>l(this._titleDiv).style("height",null)),l(this._legendDiv).style("display","none");let a=()=>{let h=this._xAxis.domain()[0];const c=[...Array(this._xAxis.domain()[1])].map(()=>{const o=[h,Math.round(Math.random()*this._yAxis.domain()[1]*100)/100];return h++,o});this._lineChartContainer.selectAll(".linePath").remove(),this._lineChartContainer.selectAll("linePath").data([c]).join("path").attr("class","linePath").attr("stroke","lightgray").attr("stroke-linecap","round").attr("stroke-width",4).attr("fill","none").attr("d",o=>i(o)).transition().duration(t*3).ease(J).attrTween("stroke-dasharray",function(){const o=this.getTotalLength();return kt(`0,${o}`,`${o},${o}`)}).on("end",()=>{this._lineChartContainer.selectAll(".linePath").attr("stroke-dasharray",function(){const o=this.getTotalLength();return o+" "+o}).attr("stroke-dashoffset",0).transition().duration(t*3).ease(J).attr("stroke-dashoffset",function(){return-this.getTotalLength()}).on("end",()=>a())})};s?a():(()=>{const h=this._lineChartContainer.selectAll(".linePath").data().map(c=>(c.line=c.line.map(o=>o[1]?[o[0],this._yAxis.domain()[0]]:[o[0],void 0]),c));this._lineChartContainer.selectAll(".linePath").data(h).transition().duration(t).ease(x).attr("d",c=>this._LineFunc(c.line)).on("end",(...[,c])=>c===0?a():null),this._lineChartContainer.selectAll(".symbolGroup").selectAll(".symbol").transition().duration(t).ease(Et).attr("transform",c=>c?`translate(${this._lineScale(c.x)},${this._yAxis(this._yAxis.domain()[0])})`:null).attr("opacity",0)})()}updateSvg(){this._loading&&(l(".tableButton").style("display",null),l(this._legendDiv).style("display",null),l(this._titleDiv).style("height",null)),this._chartData.data.xValueNames?this.margin.right=this.getTextSize(this._chartData.data.xValueNames[this._chartData.data.xValueNames.length-1])/2+1:this.margin.right=this.getTextSize(C(this._chartData.data.xValues).toString())/2+1,this.checkPercentage(),this.setDims(!0),this.mapColorToLine(),this.computeMaxVal(),this.setTickSize(),l(this._chartDiv).attr("height",this.dims.height+"px"),this._svg.attr("width",this.dims.width+"px").attr("height",this.dims.height+"px").attr("aria-label",this._chartData&&this._chartData.title?"Linjediagram om "+this._chartData.title.toLowerCase():"Linjediagram"),this._yAxis=H().domain([0,this._maxVal]).nice(3).range([this.dims.height-this.margin.bottom,this.margin.top]),this.margin.left=this.getTextSize(S(this.axisNumberFormat).format(this.formatStyle)(this._yAxis.domain()[1]))+this.yPadding+3;const s=this._xAxis.domain();if(this.initXAxis(),this._lineChartContainer.transition("position").duration(400).ease(x).attr("width",this.dims.width).attr("height",this.dims.height).attr("transform",`translate(${this.margin.left},0)`),this.setYTicks(),this.defineLineAndScale(),this.addSymbols(!0),this._loading){l(".tableButton").style("display",null),this.addListenersToChart();const t=l(this._titleDiv).style("height");l(this._titleDiv).style("height",this._prevHeight).transition("adjust").duration(400).style("height",t).on("end",()=>l(this._titleDiv).style("height",null)),l(this._legendDiv).style("opacity",0).transition().duration(400).ease(x).style("opacity",1),this._lineChartContainer.selectAll(".linePath").on("end",null),this._lineChartContainer.selectAll(".symbolGroup").selectAll(".symbol").attr("opacity",0).attr("transform",i=>i?`translate(${this._lineScale(i.x)},${this._yAxis(this._yAxis.domain()[0])})`:null),this._lineChartContainer.selectAll(".linePath").transition().duration(400).ease(J).attr("stroke-dashoffset",function(){return-this.getTotalLength()}).on("end",()=>{this._lineChartContainer.selectAll(".linePath").data(this.reshapeData(this._chartData.data.series)).join("path").attr("class","linePath").attr("stroke",i=>this.colorFunction(i)).attr("stroke-linecap","round").attr("stroke-width",4).attr("fill","none").attr("stroke-dasharray",this.dashFunction).attr("stroke-dashoffset",null).attr("d",i=>this._LineFunc(i.line.map(e=>[e[0],this._yAxis.domain()[0]]))),this._lineChartContainer.selectAll(".linePath").transition().duration(400).ease(x).attr("d",i=>this._LineFunc(i.line)),this._lineChartContainer.selectAll(".symbolGroup").selectAll(".symbol").transition().duration(400).ease(x).attr("transform",i=>i?`translate(${this._lineScale(i.x)},${this._yAxis(i.val)})`:null).attr("opacity",1),this._loading=!1})}else this._lineChartContainer.selectAll(".linePath").data(this.reshapeData(this._chartData.data.series)).join("path").transition().duration(400).ease(x).attr("class","linePath").attr("stroke",t=>this.colorFunction(t)).attr("stroke-linecap","round").attr("stroke-width",t=>t.length>1?4:6).attr("fill","none").attr("stroke-dasharray",(t,i)=>t.length>1?this.dashFunction(t,i):null).attr("d",t=>this._LineFunc(t.line));if(this._toggled&&s===this._xAxis.domain()){const t=this._chartData.data.xValues[this._tooltipDataIndex].toString();this._Circles.selectAll("circle").data(this._chartData.data.series).join("circle").transition("New circles").duration(400).ease(x).attr("stroke","white").attr("fill",a=>this.colorFunction(a)).attr("stroke-width","1px").attr("r",7),this.positionCircles(t,400);const i=this._TooltipLine.attr("y1");this._TooltipLine.transition().duration(400).ease(x).attr("x1",this._xAxis(t)+this.margin.left).attr("x2",this._xAxis(t)+this.margin.left).attr("y1",this._yAxis(this._maxVal)).attr("y2",this.dims.height-this.margin.bottom);let e=this._tooltip.select(".tooltipBody");e.select(this._tooltipHeading).style("margin","0 0.75rem").html(()=>this._chartData.data.xValueNames?this._chartData.data.xValueNames[this._tooltipPoint-1]:this._tooltipPoint),e.selectAll("div").data(this._chartData.data.series).join("div").style("display","flex").style("flex-direction","row").style("flex-wrap","nowrap").style("white-space","nowrap").style("justify-content","space-between").html(a=>"<span>"+a.title+':&nbsp</span><span class="tooltipVal">'+a.yValues[this._tooltipDataIndex]+"</span>"),this.positionTooltipWithinBounds(this._xAxis(t)+this.margin.left,400),this._tooltip.style("transform",()=>`translateY(${i-this._tooltip.node().getBoundingClientRect().height-9}px)`).transition().duration(400).ease(x).style("transform",()=>`translateY(${this._yAxis(this._maxVal)-this._tooltip.node().getBoundingClientRect().height-9}px)`),this._svg.select(".tooltipPointer").transition().duration(400).ease(x).attr("transform",`translate(${this._xAxis(t)+this.margin.left},${this._yAxis(this._maxVal)-7}) rotate(180) scale(1.5,1.0)`)}else this._Circles.selectAll("circle").data(this._chartData.data.series).join("circle").attr("stroke",t=>this.colorFunction(t)).attr("fill","white").attr("stroke-width","1px").attr("r",7).attr("display","none"),this.closeTooltip()}componentWillLoad(){this.afChartDataUpdate()}componentDidLoad(){if(Object.keys(this._chartData).length===0)return this.initEmpty();this._selectedLines=[],this.initSvg(),this.initLegend(),this.initLines(),document.fonts.onloadingdone=()=>{this.setTickSize(),this.resizeSvg()}}componentWillUpdate(){this._prevHeight=l(this._titleDiv).style("height")}componentDidUpdate(){if(Object.keys(this._chartData).length===0)return this.loadingState();this._selectedLines=[],this.updateSvg(),this.initLegend(),this.updateTableContent()}getTextSize(s){var t=[];let i=l(this._chartDiv).append("svg");return i.selectAll("dummyText").data([s]).join("text").attr("font-size",this.fontSize).text(e=>e).each((...[,e,a])=>{var n=a[e].getComputedTextLength();t.push(n),a[e].remove()}),i.remove().exit(),t[0]}setTickSize(){if(this._chartData.data.xValueNames)for(const s of this._chartData.data.xValueNames){const t=this.getTextSize(s);t>this._tickSize&&(this._tickSize=t)}else for(const s of this._chartData.data.xValues){const t=this.getTextSize(s.toString());t>this._tickSize&&(this._tickSize=t)}}leftSetAxis(s=!1){let t=[];s?(this._yAxisHandle.selectAll("text").attr("transform",(...[,i,e])=>{const a=e[i].getComputedTextLength();return t.push(a),`translate(${-1*(this.margin.left-(a+this.yPadding))},0)`}),this._yAxisHandle.selectAll("line").attr("x1",(...[,i])=>-1*(this.margin.left-(t[i]+this.yPadding)))):(this._yAxisHandle.selectAll("text").transition("shuffle text").duration(400).attr("transform",(...[,i,e])=>{const a=e[i].getComputedTextLength();return t.push(a),`translate(${-1*(this.margin.left-(a+this.yPadding))},0)`}),this._yAxisHandle.selectAll("line").transition("shuffle line").duration(400).attr("x1",(...[,i])=>-1*(this.margin.left-(t[i]+this.yPadding))))}updateTableContent(){this._tableDiv.style.display===""||this._tableDiv.style.display==="none"||(this.setTableContent(),this.animateTableDimensions())}setTableContent(){this._tableDiv.innerHTML=`<digi-table af-size="small" af-variation="primary"> <table><caption>${this._chartData.title}</caption><thead><tr>${this.headings()}</tr></thead><tbody>${this.tableBody()}</tbody></table></digi-table>`}setTableDimensions(){const s=l(this._tableDiv);s.style("height",this._maxHeight-l(this._titleDiv).node().getBoundingClientRect().height-parseFloat(getComputedStyle(document.documentElement).fontSize)*.65+"px"),s.style("width",this.dims.width-parseFloat(getComputedStyle(document.documentElement).fontSize)*.65+"px")}animateTableDimensions(){const s=l(this._titleDiv).style("height");l(this._titleDiv).style("height",this._prevHeight).transition("adjust").duration(400).style("height",s).on("end",()=>l(this._titleDiv).style("height",null));const t=l(this._tableDiv);t.transition("adjustHeight").duration(400).style("height",this._maxHeight-(parseFloat(s)+parseFloat(getComputedStyle(document.documentElement).fontSize)*1.25)-parseFloat(getComputedStyle(document.documentElement).fontSize)*.65+"px"),t.style("width",this.dims.width-parseFloat(getComputedStyle(document.documentElement).fontSize)*.65+"px")}headings(){let s=`<th scope="col">${this._chartData.x}</th>`;return this._coreSeries.forEach(t=>{s=s.concat(`<th scope="col">${t.title}</th>`)}),s}tableBody(){let s="";return(this._chartData.data.xValueNames?this._chartData.data.xValueNames:this._chartData.data.xValues).forEach((i,e)=>{let a="";this._coreSeries.forEach(n=>{a=a.concat(`<td>${n.yValues[e]!=null?S(this.axisNumberFormat).format(this.formatStyle)(n.yValues[e]):"-"}</td>`)}),s=s.concat(`<tr><th scope='row'>${i}${a}</th></tr>`)}),s}render(){let s="";return this._chartData.subTitle?s=`<${this.afHeadingLevel}>${this._chartData.title}</${this.afHeadingLevel}><p>${this._chartData.subTitle}</p>`:s=`<${this.afHeadingLevel}>${this._chartData.title}</${this.afHeadingLevel}>`,y("host",{ref:t=>this._host=t},y("div",{class:"topWrapper",ref:t=>this._titleDiv=t},y("digi-typography",{class:"chartTitle",innerHTML:s}),y("digi-button",{class:"buttonWrapper tableButton","af-size":"medium","af-variation":"function","af-full-width":"false",onAfOnClick:this.activateTable},y("digi-icon-table",{slot:"icon"}),"Visa tabell"),y("digi-button",{style:{display:"none"},class:"buttonWrapper chartButton","af-size":"medium","af-variation":"function","af-full-width":"false",onAfOnClick:this.reInitChart},y("digi-icon-chart",{slot:"icon"}),"Visa diagram"),y("div",{class:"scChartStatus",role:"status",ref:t=>this._status=t})),y("div",{class:"chartTooltip",id:this.afId},y("div",{class:"tooltipBody"}),y("digi-icon-x",{class:"close"})," "),y("div",{class:"chart",ref:t=>this._chartDiv=t}),y("div",{class:"legend",ref:t=>this._legendDiv=t}),y("div",{class:"table",ref:t=>this._tableDiv=t}," "))}get element(){return vt(this)}static get watchers(){return{afChartData:["afChartDataUpdate"]}}};Qt.style=Kt;export{Qt as digi_chart_line};
